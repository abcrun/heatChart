/**
 * @license MIT
 * @author Bruce Yang(https://github.com/abcrun/Gesture)
 **/
!function(e,t){"function"==typeof define&&define.amd?define(t):"object"==typeof module&&module.exports?module.exports=t():e.Gesture=t()}(this,function(){function x(e){var t=e.style&&e.style.cssText||"",a=parseFloat((/scale(?:3d)?\((.+)\)/.exec(t)||[1,1])[1]),n=parseFloat((/rotate(?:3d)?\((.+)\)/.exec(t)||[0,0])[1]),s=(/translate(?:3d)\((.+)\)/.exec(t)||["0,0","0,0"])[1].split(",");return{scale:a,rotate:n,tx:parseFloat(s[0])*a,ty:parseFloat(s[1])*a}}function T(e){return 1==e.length}function s(e){return 2==e.length}function y(e){var t={time:(new Date).getTime(),event:e};if(2==e.touches.length){var a=e.touches[0],n=e.touches[1],s=n.pageX-a.pageX,l=n.pageY-a.pageY,o=Math.sqrt(s*s+l*l),i=Math.sqrt(o*o/4-l*l/4),r=a.pageY+l/2,c=a.pageX+(s<0?-i:i);t.length=o,t.center={pageX:c,pageY:r}}return t}function h(e,t){var a=e.style.cssText||"",n=t.duration||"0s",s=t.rotate||"0";scale=t.scale||1,translate=t.translate||"0,0,0",transform="-webkit-transform:scale3d("+scale+","+scale+",1) translate3d("+translate+") rotate("+s+"deg)",e.style.cssText=a+";-webkit-transform-style: preserve-3d;-webkit-transform-origin: 0 0;transition-duration:"+n+";"+transform}function b(e,t,a,n){var s=this,l=this.events[e]||[],o=[t,a,n];l.forEach(function(e){e.apply(s,o)})}function e(e){this.element=e,this.events={},this.enabled=["tap"],function(){function p(e){return-1<m.enabled.indexOf(e)}var u,f,d,c,g,v,m=this,a=this.element,n=function(e){for(var t=e.offsetLeft,a=e.offsetTop;e.offsetParent;)t+=(e=e.offsetParent).offsetLeft,a+=e.offsetTop;return{left:t,top:a}}(a);this.element.addEventListener("touchstart",function(e){if(e.preventDefault(),u=x(a),f=y(e),s(e.touches)){var t=f.center;c={x:t.pageX-n.left,y:t.pageY-n.top}}console.log("start:"+e.touches.length+":"+e.changedTouches.length+":"+e.targetTouches.length)},!1),this.element.addEventListener("touchmove",function(e){e.preventDefault(),d=y(e),console.log("move:"+e.touches.length+":"+e.changedTouches.length+":"+e.targetTouches.length),(p("slide")||p("slideLeftRight")||p("slideUpDown"))&&T(e.touches)&&T(f.event.touches)&&function(){var e=u.tx,t=u.ty,a=u.scale,n=u.rotate,s=f.event.touches[0],l=d.event.touches[0],o=l.pageX-s.pageX,i=l.pageY-s.pageY;p("slideUpDown")||p("slideLeftRight")?(1==(g=g||(p("slideUpDown")&&p("slideLeftRight")?Math.abs(o)>Math.abs(i)?1:2:p("slideUpDown")?2:!!p("slideLeftRight")&&1))&&(name="slideLeftRight")&&(ntx=(e+o)/a)&&(i=0),2==g&&(name="slideUpDown")&&(nty=(t+i)/a)&&(o=0)):(ntx=(e+o)/a,nty=(t+i)/a,name="slide"),h(this.element,{translate:ntx+"px,"+nty+"px, 0",scale:a,rotate:n}),b.call(this,name,{scale:a,offset:{x:o,y:i,rotate:n}},d,f)}.call(m),(p("pinch")||p("rotate"))&&s(e.targetTouches)&&(p("pinch")&&(v=!0)&&function(){var e=u.tx,t=u.ty,a=u.scale,n=u.rotate,s=f.length,l=d.length/s,o=a*l;this.maxScale&&o>this.maxScale&&(l=(o=this.maxScale)/a),this.minScale&&o<this.minScale&&(l=(o=this.minScale)/a);var i=(e-(l-1)*(c.x-e))/o,r=(t-(l-1)*(c.y-t))/o;h(this.element,{translate:i+"px,"+r+"px, 0",scale:o,rotate:n}),b.call(this,"pinch",{prevScale:a,currentScale:o},d,f)}.call(m),p("rotate")&&function(){}.call(m))},!1),this.element.addEventListener("touchend",function(e){var t=f.event.touches,a=(d&&d.event.changedTouches,e.changedTouches),n=y(e),s=n.time,l=s-f.time;if(e.preventDefault(),0==e.touches.length){if(console.log("end:"+e.touches.length+":"+e.changedTouches.length+":"+e.targetTouches.length),T(t)){var o=Math.abs(a[0].pageX-t[0].pageX),i=Math.abs(a[0].pageY-t[0].pageY);if(o<10&&i<10){var r,c=m.__lastTouch;if("tap"==(r=c&&s-c.time<300?"doubletap":l<200?"tap":"longtap")&&(m.__lastTouch=f),"tap"==r&&p("doubletap")&&m.events.doubletap&&m.events.tap){var h=setTimeout(function(){b.call(m,"tap",u,n,f)},300);m.__lastTouch.itv=h}else c&&c.itv&&clearTimeout(c.itv),p(r)&&b.call(m,r,u,n,f)}else(r=1==g?"slideLeftRightEnd":2==g?"slideUpDownEnd":p("slide")?"slideEnd":void 0)&&b.call(m,r,x(m.element),n,f)}else(r=v?"pinchEnd":void 0)&&b.call(m,r,x(m.element),n,f);d=null}},!1)}.call(this)}return e.prototype={enable:function(){for(var e=["tap","longtap","doubletap","slide","slideLeftRight","slideUpDown","pinch","rotate"],t=0;t<arguments.length;t++){var a=arguments[t];if(!(-1<e.indexOf(a)))throw new Error('仅支持 "'+e.join("|")+'" 手势');this.enabled.indexOf(a)<0&&this.enabled.push(a)}},disable:function(){for(var e=0;e<arguments.length;e++){var t=arguments[e],a=this.enabled.indexOf(t);-1<a&&this.enabled.splice(a,1)}},addEvent:function(e,t){t=t||function(){},this.events[e]?this.events[e].push(t):this.events[e]=[t]},removeEvent:function(e){e?delete this.events[e]:this.events={}},scaleTo:function(e,t){var a=this.element,n=a.style&&a.style.cssText||"",s=(/translate3d\((.+)\)/.exec(n)||["0,0,0","0,0,0"])[1].split(","),l=parseFloat(s[0]),o=parseFloat(s[1]);h(a,{scale:e,rotate:parseFloat((/rotate\((.+)\)/.exec(n)||[0,0])[1]),translate:l+"px,"+o+"px,0",duration:t})},slideTo:function(e,t){var a=this.element,n=a.style&&a.style.cssText||"",s=parseFloat((/scale\((.+)\)/.exec(n)||[1,1])[1]),l=parseFloat(translate[0]),o=parseFloat(translate[1]);h(a,{scale:s,rotate:parseFloat((/rotate\((.+)\)/.exec(n)||[0,0])[1]),translate:e.x/s+l+"px,"+(e.y/s+o)+"px,0",duration:t})},setOption:function(e){var t=e.minScale,a=e.maxScale;t&&(this.minScale=t),a&&(this.maxScale=a)}},e});
/**
 * @license MIT
 * @author Bruce Yang(https://github.com/abcrun/heatChart)
 **/
!function(t,e){"function"==typeof define&&define.amd?define(e):"object"==typeof module&&module.exports?module.exports=e():t.heatChart=e()}(this,function(){function r(t,e,i,a){var n=document.createElement("div"),r=document.createElement("canvas"),s=document.createElement("canvas"),o=r.getContext("2d"),h=s.getContext("2d");n.appendChild(r),n.appendChild(s),t.appendChild(n);var l=new Gesture(n);a&&l.enable("slide","pinch"),this.element=t,this.container=n,this.canvas={front:s,back:r},this.context={front:h,back:o},this.offset={width:0,height:0},this.colors=function(t){var e=document.createElement("canvas"),i=e.getContext("2d"),a=256;e.width=a,e.height=10;var n=i.createLinearGradient(0,0,a,10);for(key in t)n.addColorStop(key,t[key]);return i.fillStyle=n,i.fillRect(0,0,a,10),i.getImageData(0,0,a,1).data}(e||{0:"yellow",1:"red"}),this.autoscale=a||!1,this.radius=i||12,this.renderRadius=this.radius,this.image=null,this.data=null,this.filter=null,this.gesture=l,this.events={},function(){var S=this,t=this.gesture;t.addEvent("tap",function(t,e,i){var a=S.element,n=(S.data||{}).list,r=e.event.changedTouches[0],s=function(t){for(var e=t.offsetLeft,i=t.offsetTop;t.offsetParent;){e+=(t=t.offsetParent).offsetLeft,i+=t.offsetTop}return{left:e,top:i}}(a),o=s.left,h=s.top,l=r.pageX,c=r.pageY,d=t.tx,f=t.ty,u=t.scale,v=(l-o-d)/u,p=(c-h-f)/u,g=Math.ceil(1/u/2),m=2*S.radius,x=Math.ceil(p/m),w=Math.ceil(v/m);if(n){for(var y,C=0,E=x-g;E<x+g;E++)for(var b=w-g;b<w+g;b++){var k=n[E];if(k&&(k=k[b])){var R=k.value;C<R&&(C=R,y=k)}}S.events.tap&&S.events.tap.call(S,y,l,c,t)}}),t.addEvent("slide",function(){S.events.slide&&S.events.slide.apply(S,arguments)}),t.addEvent("pinch",function(){S.events.pinch&&S.events.pinch.apply(S,arguments)})}.call(this)}return r.prototype={clear:function(){var t=this.context.front,e=this.context.back,i=this.canvas.front,a=i.width,n=i.height;t.clearRect(0,0,a,n),e.clearRect(0,0,a,n)},setOptions:function(t){var o=this,e=this.element,h=this.container,l=this.canvas.front,c=this.canvas.back,d=this.autoscale,f=this.radius,i=this.image||new Image,u=t.width||this.offset.width||e.offsetWidth,v=t.height||this.offset.height||e.offsetHeight,a=t.url,n=t.data,r=t.filter;this.image=i,this.offset={width:u,height:v},this.data=function(t,r,s,e){var o=[],h=0,l=0,c=2*e;if(!(t=t||[]).length)return{list:[],max:0,min:0};var d=(t[0].xCoord||t[0].x)<1;return t.forEach(function(t){var e=t.x||t.xCoord,i=t.y||t.yCoord,a=t.value||t.hotValue;e=Math.ceil((d?e*r:e)/c),i=Math.ceil((d?i*s:i)/c),h<a&&(h=a),a<l&&(l=a),o[i]||(o[i]=[]),t.x=e*c,t.y=i*c,t.value=a;var n=o[i][e];o[i][e]=n&&n.value>t.value?n:t}),{list:o,min:l,max:h}}(n,u,v,f),this.filter=r||(n?[this.data.min,this.data.max]:this.filter),a?(i.src=a,i.onload=function(){var t=this.width,e=this.height,i=u/t,a=v/e,n=i<a?i:a,r="width:"+t+"px;height:"+e+"px;",s="position:relative;transform-origin:0 0;"+(d?r+"transform: scale3d("+n+","+n+", 1) translate3d("+(u-t*n)/2/n+"px,"+(v-e*n)/2/n+"px,0)":r);h.style.cssText=s,l.style.cssText=c.style.cssText=r+"position:absolute;top:0;left:0;",l.width=c.width=t,l.height=c.height=e,o.renderRadius=f/n,d&&o.gesture.setOption({minScale:n}),o.render()}):this.render()},render:function(){var t=this,e=this.data.list,i=this.filter||[0,0],a=i[0],n=i[1],r=this.image.width,s=this.image.height,o=this.renderRadius,h=this.colors,l=this.context.back,c=this.context.front;if(this.clear(),this.image.complete)l.drawImage(this.image,0,0,r,s),e.forEach(function(t){t.length&&t.forEach(function(t){!t||t.value<a||t.value>n||function(t,e,i,a){var n=t.x,r=t.y;t.value;a.beginPath(),a.arc(n,r,1.2*i,0,2*Math.PI),a.closePath();var s=a.createRadialGradient(n,r,0,n,r,i);s.addColorStop(0,"rgba(0,0,0,1)"),s.addColorStop(.5,"rgba(0,0,0,1)"),s.addColorStop(1,"rgba(0,0,0,0)"),a.fillStyle=s,a.globalAlpha=e,a.fill()}(t,n==a&&0!=n?1:(t.value-a)/(n-a),o,c)})}),function(t,e,i,a){for(var n=t.getImageData(0,0,e,i),r=n.data,s=3;s<r.length;s+=4){var o=r[s],h=a.slice(4*o,4*o+3);r[s-3]=h[0],r[s-2]=h[1],r[s-1]=h[2]}t.putImageData(n,0,0,0,0,e,i)}(c,r,s,h),this.events.render&&this.events.render.call(this);else{var d=0;setTimeout(function(){if(!(d<=50))throw d=0,new Error("load url error");t.render()},200)}},setFilter:function(t){this.filter=t,this.render()},addEvent:function(t,e){e=e||function(){};this.events[t]=e},removeEvent:function(t){delete this.events[t]}},{create:function(t){var e=t.element,i=t.colors,a=t.radius,n=t.autoscale;if(!e)throw new Error("need options.element");return new r(e,i,a,n)}}});
