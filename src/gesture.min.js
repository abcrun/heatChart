/**
 * @license MIT
 * @author Bruce Yang(https://github.com/abcrun/Gesture)
 **/
!function(e,t){"function"==typeof define&&define.amd?define(t):"object"==typeof module&&module.exports?module.exports=t():e.Gesture=t()}(this,function(){function x(e){var t=e.style&&e.style.cssText||"",a=parseFloat((/scale(?:3d)?\((.+)\)/.exec(t)||[1,1])[1]),n=parseFloat((/rotate(?:3d)?\((.+)\)/.exec(t)||[0,0])[1]),s=(/translate(?:3d)\((.+)\)/.exec(t)||["0,0","0,0"])[1].split(",");return{scale:a,rotate:n,tx:parseFloat(s[0])*a,ty:parseFloat(s[1])*a}}function T(e){return 1==e.length}function s(e){return 2==e.length}function y(e){var t={time:(new Date).getTime(),event:e};if(2==e.touches.length){var a=e.touches[0],n=e.touches[1],s=n.pageX-a.pageX,l=n.pageY-a.pageY,o=Math.sqrt(s*s+l*l),i=Math.sqrt(o*o/4-l*l/4),r=a.pageY+l/2,c=a.pageX+(s<0?-i:i);t.length=o,t.center={pageX:c,pageY:r}}return t}function h(e,t){var a=e.style.cssText||"",n=t.duration||"0s",s=t.rotate||"0";scale=t.scale||1,translate=t.translate||"0,0,0",transform="-webkit-transform:scale3d("+scale+","+scale+",1) translate3d("+translate+") rotate("+s+"deg)",e.style.cssText=a+";-webkit-transform-style: preserve-3d;-webkit-transform-origin: 0 0;transition-duration:"+n+";"+transform}function b(e,t,a,n){var s=this,l=this.events[e]||[],o=[t,a,n];l.forEach(function(e){e.apply(s,o)})}function t(){function p(e){return-1<m.enabled.indexOf(e)}var u,f,d,c,g,v,m=this,a=this.element,n=function(e){for(var t=e.offsetLeft,a=e.offsetTop;e.offsetParent;){t+=(e=e.offsetParent).offsetLeft,a+=e.offsetTop}return{left:t,top:a}}(a);this.element.addEventListener("touchstart",function(e){if(e.preventDefault(),u=x(a),f=y(e),s(e.touches)){var t=f.center;c={x:t.pageX-n.left,y:t.pageY-n.top}}console.log("start:"+e.touches.length+":"+e.changedTouches.length+":"+e.targetTouches.length)},!1),this.element.addEventListener("touchmove",function(e){e.preventDefault(),d=y(e),console.log("move:"+e.touches.length+":"+e.changedTouches.length+":"+e.targetTouches.length),(p("slide")||p("slideLeftRight")||p("slideUpDown"))&&T(e.touches)&&T(f.event.touches)&&function(){var e=u.tx,t=u.ty,a=u.scale,n=u.rotate,s=f.event.touches[0],l=d.event.touches[0],o=l.pageX-s.pageX,i=l.pageY-s.pageY;p("slideUpDown")||p("slideLeftRight")?(1==(g=g||(p("slideUpDown")&&p("slideLeftRight")?Math.abs(o)>Math.abs(i)?1:2:p("slideUpDown")?2:!!p("slideLeftRight")&&1))&&(name="slideLeftRight")&&(ntx=(e+o)/a)&&(i=0),2==g&&(name="slideUpDown")&&(nty=(t+i)/a)&&(o=0)):(ntx=(e+o)/a,nty=(t+i)/a,name="slide"),h(this.element,{translate:ntx+"px,"+nty+"px, 0",scale:a,rotate:n}),b.call(this,name,{scale:a,offset:{x:o,y:i,rotate:n}},d,f)}.call(m),(p("pinch")||p("rotate"))&&s(e.targetTouches)&&(p("pinch")&&(v=!0)&&function(){var e=u.tx,t=u.ty,a=u.scale,n=u.rotate,s=f.length,l=d.length/s,o=a*l;this.maxScale&&o>this.maxScale&&(l=(o=this.maxScale)/a),this.minScale&&o<this.minScale&&(l=(o=this.minScale)/a);var i=(e-(l-1)*(c.x-e))/o,r=(t-(l-1)*(c.y-t))/o;h(this.element,{translate:i+"px,"+r+"px, 0",scale:o,rotate:n}),b.call(this,"pinch",{prevScale:a,currentScale:o},d,f)}.call(m),p("rotate")&&function(){}.call(m))},!1),this.element.addEventListener("touchend",function(e){var t=f.event.touches,a=(d&&d.event.changedTouches,e.changedTouches),n=y(e),s=n.time,l=s-f.time;if(e.preventDefault(),0==e.touches.length){if(console.log("end:"+e.touches.length+":"+e.changedTouches.length+":"+e.targetTouches.length),T(t)){var o=Math.abs(a[0].pageX-t[0].pageX),i=Math.abs(a[0].pageY-t[0].pageY);if(o<10&&i<10){var r,c=m.__lastTouch;if("tap"==(r=c&&s-c.time<300?"doubletap":l<200?"tap":"longtap")&&(m.__lastTouch=f),"tap"==r&&p("doubletap")&&m.events.doubletap&&m.events.tap){var h=setTimeout(function(){b.call(m,"tap",u,n,f)},300);m.__lastTouch.itv=h}else c&&c.itv&&clearTimeout(c.itv),p(r)&&b.call(m,r,u,n,f)}else(r=1==g?"slideLeftRightEnd":2==g?"slideUpDownEnd":p("slide")?"slideEnd":void 0)&&b.call(m,r,x(m.element),n,f)}else(r=v?"pinchEnd":void 0)&&b.call(m,r,x(m.element),n,f);d=null}},!1)}function e(e){this.element=e,this.events={},this.enabled=["tap"],t.call(this)}return e.prototype={enable:function(){for(var e=["tap","longtap","doubletap","slide","slideLeftRight","slideUpDown","pinch","rotate"],t=0;t<arguments.length;t++){var a=arguments[t];if(!(-1<e.indexOf(a)))throw new Error('仅支持 "'+e.join("|")+'" 手势');this.enabled.indexOf(a)<0&&this.enabled.push(a)}},disable:function(){for(var e=0;e<arguments.length;e++){var t=arguments[e],a=this.enabled.indexOf(t);-1<a&&this.enabled.splice(a,1)}},addEvent:function(e,t){t=t||function(){};this.events[e]?this.events[e].push(t):this.events[e]=[t]},removeEvent:function(e){e?delete this.events[e]:this.events={}},scaleTo:function(e,t){var a=this.element,n=a.style&&a.style.cssText||"",s=(/translate3d\((.+)\)/.exec(n)||["0,0,0","0,0,0"])[1].split(","),l=parseFloat(s[0]),o=parseFloat(s[1]),i=parseFloat((/rotate\((.+)\)/.exec(n)||[0,0])[1]);h(a,{scale:e,rotate:i,translate:l+"px,"+o+"px,0",duration:t})},slideTo:function(e,t){var a=this.element,n=a.style&&a.style.cssText||"",s=parseFloat((/scale\((.+)\)/.exec(n)||[1,1])[1]),l=parseFloat(translate[0]),o=parseFloat(translate[1]),i=parseFloat((/rotate\((.+)\)/.exec(n)||[0,0])[1]),r=e.x/s+l,c=e.y/s+o;h(a,{scale:s,rotate:i,translate:r+"px,"+c+"px,0",duration:t})},setOption:function(e){var t=e.minScale,a=e.maxScale;t&&(this.minScale=t),a&&(this.maxScale=a)}},e});